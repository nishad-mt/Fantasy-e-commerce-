<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  {% block title %}
  <title>Fantasy Food â€” Admin Dashboard</title>
  {% endblock %}
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Heroicons (optional) -->
  <script src="https://unpkg.com/feather-icons"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link
    href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Playfair+Display:wght@600;700&display=swap"
    rel="stylesheet">
  <!-- Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css"/>


  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Outfit', 'sans-serif'],
            serif: ['Playfair Display', 'serif'],
          },
          colors: {
            stone: {
              50: '#fafaf9',
              100: '#f5f5f4',
              200: '#e7e5e4',
              300: '#d6d3d1',
              400: '#a8a29e',
              500: '#78716c',
              600: '#57534e',
              700: '#44403c',
              800: '#292524',
              900: '#1c1917',
            },
            amber: {
              50: '#fffbeb',
              100: '#fef3c7',
              200: '#fde68a',
              300: '#fcd34d',
              400: '#fbbf24',
              500: '#f59e0b',
              600: '#d97706',
              700: '#b45309',
              800: '#92400e',
              900: '#78350f',
            }
          }
        }
      }
    }
  </script>

  <style>
    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #f5f5f4;
    }

    ::-webkit-scrollbar-thumb {
      background: #d6d3d1;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #a8a29e;
    }

    /* Utilities mirroring admin_categories */
    .card {
      background-color: white;
      border: 1px solid #e7e5e4;
      /* stone-200 */
      border-radius: 0.75rem;
      /* rounded-xl */
      box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    }

    .table-scroll {
      overflow-x: auto;
    }

    .btn-primary {
      background-color: #d97706;
      /* amber-600 */
      color: white;
      transition: all 0.2s;
    }

    .btn-primary:hover {
      background-color: #b45309;
      /* amber-700 */
    }
  </style>
</head>

<body class="bg-[#fafaf9] text-stone-800 font-sans antialiased min-h-screen flex text-sm">

  <!-- SIDEBAR -->
  <aside class="w-64 bg-white border-r border-stone-200 hidden md:flex flex-col h-screen sticky top-0 shrink-0">
    <div class="p-6 border-b border-stone-100 flex items-center gap-3">
      <div class="w-8 h-8 rounded-full bg-amber-100 flex items-center justify-center text-amber-700">
        <span class="font-serif font-bold text-lg">F</span>
      </div>
      <div>
        <h1 class="font-serif font-bold text-xl text-stone-800">Fantasy Admin</h1>
        <p class="text-xs text-stone-500">Admin Panel</p>
      </div>
    </div>

    <nav class="flex-1 p-4 space-y-1 overflow-y-auto">
      <a href="{% url 'dashboard' %}"
        class="w-full text-left nav-btn px-3 py-2 rounded-lg hover:bg-stone-50 hover:text-amber-700 transition-colors flex items-center gap-3 text-stone-600"
        data-tab="dashboard">
        <i class="fa-solid fa-chart-line w-5"></i> Dashboard
    </a>

      <a href="{% url 'user' %}"
        class="w-full text-left nav-btn px-3 py-2 rounded-lg hover:bg-stone-50 hover:text-amber-700 transition-colors flex items-center gap-3 text-stone-600"
        data-tab="users">
        <i class="fa-solid fa-users w-5"></i> Users
  </a>

      <a href="{% url 'admin_products' %}"
        class="w-full text-left nav-btn px-3 py-2 rounded-lg hover:bg-stone-50 hover:text-amber-700 transition-colors flex items-center gap-3 text-stone-600"
        data-tab="products">
        <i class="fa-solid fa-box-open w-5"></i> Products
  </a>

      <a href="{% url 'offers' %}"
        class="w-full text-left nav-btn px-3 py-2 rounded-lg hover:bg-stone-50 hover:text-amber-700 transition-colors flex items-center gap-3 text-stone-600"
        data-tab="offers">
        <i class="fa-solid fa-ticket w-5"></i> Offers
  </a>

      <a href="{% url 'categories' %}"
        class="w-full text-left nav-btn px-3 py-2 rounded-lg hover:bg-stone-50 hover:text-amber-700 transition-colors flex items-center gap-3 text-stone-600"
        data-tab="categories">
        <i class="fa-solid fa-layer-group w-5"></i> Categories
</a>
      <a href="{% url 'orders' %}"
        class="w-full text-left nav-btn px-3 py-2 rounded-lg hover:bg-stone-50 hover:text-amber-700 transition-colors flex items-center gap-3 text-stone-600"
        data-tab="categories">
        <i class="fa-solid fa-cart-shopping"></i> Orders
</a>
      <a href="{% url 'payments' %}"
        class="w-full text-left nav-btn px-3 py-2 rounded-lg hover:bg-stone-50 hover:text-amber-700 transition-colors flex items-center gap-3 text-stone-600"
        data-tab="categories">
        <i class="fa-solid fa-credit-card"></i> Payments
</a>

      <a href="{% url 'admin_reviews' %}"
        class="w-full text-left nav-btn px-3 py-2 rounded-lg hover:bg-stone-50 hover:text-amber-700 transition-colors flex items-center gap-3 text-stone-600"
        data-tab="refunds">
        <i class="fa-solid fa-star"></i> Reviews
    </a>

      <a href="{% url 'admin_contact' %}"
        class="w-full text-left nav-btn px-3 py-2 rounded-lg hover:bg-stone-50 hover:text-amber-700 transition-colors flex items-center gap-3 text-stone-600"
        data-tab="site">
        <i class="fa-solid fa-gear w-5"></i> Site Info
    </a>

      <a href="{% url 'admin_wallet_dashboard' %}"
        class="w-full text-left nav-btn px-3 py-2 rounded-lg hover:bg-stone-50 hover:text-amber-700 transition-colors flex items-center gap-3 text-stone-600"
        data-tab="activity">
        <i class="fa-solid fa-wallet w-5"></i> Wallet
    </a>
    </nav>

    <div class="p-4 border-t border-stone-100">
      <button id="resetBtn"
        class="w-full py-2 bg-amber-700 text-white rounded-lg text-sm hover:bg-amber-800 transition-colors shadow-sm">Reset
        Demo Data</button>
    </div>
  </aside>
{% block content %}
  <!-- MAIN -->
  <main class="flex-1 flex flex-col min-w-0 overflow-hidden h-screen bg-[#fafaf9]">
    <!-- top -->
    <header class="bg-white border-b border-stone-200 sticky top-0 z-20 px-6 py-4 flex items-center justify-between">
      <div class="flex items-center gap-4">
        <button id="mobileMenuBtn" class="md:hidden text-stone-500 hover:text-stone-700"><i
            class="fa-solid fa-bars text-xl"></i></button>
        <div>
          <h2 id="pageTitle" class="text-2xl font-bold font-serif text-stone-800">Dashboard</h2>
          <div class="text-xs text-stone-500 hidden md:block" id="subTitle">Overview & quick actions</div>
        </div>
      </div>
      <div class="flex items-center gap-3">
        <a href="{% url 'admin_logout' %}"
          class="py-2 px-3 rounded-lg border border-stone-200 text-stone-600 hover:bg-red-600 hover:text-white text-xs font-medium">
          Logout</a>
        <div class="flex items-center gap-3 pl-3 border-l border-stone-200">
          <div class="w-8 h-8 rounded-full bg-amber-600 text-white flex items-center justify-center font-bold text-xs">A
          </div>
          <div class="hidden sm:block">
            <div class="text-sm font-medium text-stone-800">Admin</div>
            <div class="text-[10px] text-stone-500">{{sitedetails.email}}</div>
          </div>
        </div>
      </div>
    </header>

    <!-- CONTENT AREA -->
    <section id="contentArea" class="flex-1 overflow-y-auto p-4 md:p-8 space-y-6">

      <!-- Dashboard -->
      <div id="tab-dashboard" class="tab-panel">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
          <div class="p-5 card flex flex-col justify-between">
            <div class="text-xs font-bold text-stone-400 uppercase tracking-wider">Users</div>
            <div id="statUsers" class="text-3xl font-bold text-stone-800 mt-2">{{ total_users }}</div>
          </div>
          <div class="p-5 card flex flex-col justify-between">
            <div class="text-xs font-bold text-stone-400 uppercase tracking-wider">Products</div>
            <div id="statProducts" class="text-3xl font-bold text-stone-800 mt-2">{{ total_products }}</div>
          </div>
          <div class="p-5 card flex flex-col justify-between">
            <div class="text-xs font-bold text-stone-400 uppercase tracking-wider">ðŸ›’ Todayâ€™s Orders</div>
            <div id="statRefunds" class="text-3xl font-bold mt-2"> {{todays_order_count}}</div>
          </div>
          <div class="p-5 card flex flex-col justify-between">
            <div class="text-xs font-bold text-stone-400 uppercase tracking-wider">Todayâ€™s Revenue</div>
            <div id="statRefunds" class="text-3xl font-bold text-green-600 mt-2"> â‚¹{{todays_revenue|floatformat:2}}</div>
          </div>
        </div>

        <div class="mt-6 grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div class="p-5 card">
            <div class="flex items-center justify-between mb-4 border-b border-stone-100 pb-2">
              <div>
                <h3 class="font-bold text-stone-800">Recent Users</h3>
                <div class="text-[10px] text-stone-400 uppercase">Latest signups</div>
              </div>
            </div>
            <div class="table-scroll">
              <table class="w-full text-sm text-left">
                <thead class="text-xs text-stone-400 uppercase bg-stone-50">
                  <tr>
                    <th class="p-2 rounded-l">Name</th>
                    <th class="p-2">Email</th>
                    <th class="p-2 rounded-r">Joined</th>
                  </tr>
                </thead>
                <tbody id="recentUsersTbody" class="divide-y divide-stone-50">
                  {% for rec in rec_users %}
                  <tr class="hover:bg-amber-200 transition-colors">
                    <td>{{ rec.username }}</td>
                  <td >{{ rec.email }}</td>
                  <td>
                    {% if rec.joined_at %}
                      {{ rec.joined_at|date:"d M Y" }}
                    {% else %}
                      â€”
                    {% endif %}
                  </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>

          <div class="max-h-64 overflow-auto">
              <table class="w-full text-sm border-collapse">
                  <thead class="sticky top-0 bg-white">
                      <tr class="text-xs text-stone-400 uppercase border-b">
                          <th class="text-left p-2">Product</th>
                          <th class="text-center p-2">Wishlists</th>
                          <th class="text-center p-2">Carts</th>
                          <th class="text-center p-2">Orders</th>
                          <th class="text-center p-2">Demand</th>
                      </tr>
                  </thead>

                  <tbody>
                      {% for p in products %}
                      <tr class="border-b last:border-none hover:bg-stone-50 transition">
                          <td class="p-2 font-medium text-stone-700 truncate">
                              {{ p.name }}
                          </td>
                          <td class="p-2 text-center text-blue-600">
                              {{ p.wishlist_count }}
                          </td>
                          <td class="p-2 text-center text-amber-600">
                              {{ p.cart_count }}
                          </td>
                          <td class="p-2 text-center text-emerald-600 font-semibold">
                              {{ p.ordered_count }}
                          </td>
                          <td class="p-2 text-center text-xs font-semibold">
                                {% if p.ordered_count > 5 %}
                                    <span class="text-emerald-600">High Demand</span>
                                {% elif p.cart_count > p.wishlist_count %}
                                    <span class="text-green-600">Hot</span>
                                {% elif p.wishlist_count > 10 %}
                                    <span class="text-amber-600">Trending</span>
                                {% else %}
                                    <span class="text-stone-400">Normal</span>
                                {% endif %}
                            </td>
                      </tr>
                      {% endfor %}
                  </tbody>
              </table>
          </div>
        </div>
        
        <!-- PENDING ORDERS (FULL WIDTH) -->
        <div class="card mt-10">

            <!-- Header -->
            <div class="px-16 py-4 border-b border-stone-100 flex items-center justify-between">
                <h3 class="text-lg font-bold text-stone-800">
                    Pending Orders
                </h3>
                <span class="text-xs text-stone-500">
                    {{ pending_orders|length }} orders
                </span>
            </div>

            {% if pending_orders %}
            <!-- Table -->
            <div class="table-scroll">
                <table class="w-full text-sm">
                    <thead class="bg-stone-50 text-stone-500 uppercase text-xs">
                        <tr>
                            <th class="px-6 py-3 text-left">Order ID</th>
                            <th class="px-6 py-3 text-left">Customer</th>
                            <th class="px-6 py-3 text-left">Total</th>
                            <th class="px-6 py-3 text-left">Placed</th>
                            <th class="px-6 py-3 text-left">Status</th>
                            <th class="px-6 py-3 text-right">Action</th>
                        </tr>
                    </thead>

                    <tbody class="divide-y divide-stone-100">
                        {% for order in pending_orders %}
                        <tr class="hover:bg-stone-50 transition">

                            <td class="px-6 py-4 font-medium text-stone-800">
                                #{{ order.order_id }}
                            </td>

                            <td class="px-6 py-4 text-stone-700">
                                {{ order.user.get_full_name|default:order.user.username }}
                            </td>

                            <td class="px-6 py-4 font-semibold text-stone-800">
                                â‚¹{{ order.total_amount }}
                            </td>

                            <td class="px-6 py-4 text-stone-500">
                                {{ order.created_at|timesince }} ago
                            </td>

                            <td class="px-6 py-4">
                                {% if order.status == "PENDING" %}
                                    <span class="px-3 py-1 rounded-full text-xs font-semibold bg-yellow-100 text-yellow-800">
                                        Pending
                                    </span>
                                {% elif order.status == "CONFIRMED" %}
                                    <span class="px-3 py-1 rounded-full text-xs font-semibold bg-blue-100 text-blue-800">
                                        Confirmed
                                    </span>
                                {% endif %}
                            </td>

                            <td class="px-6 py-4 text-right">
                                <a href="{% url 'admin_order_detail' order.order_id %}"
                                  class="text-amber-700 hover:text-amber-900 font-semibold text-sm">
                                    View â†’
                                </a>
                            </td>

                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
                <div class="p-6 text-center text-stone-500">
                    ðŸŽ‰ No pending orders at the moment
                </div>
            {% endif %}
        </div>
    </section>
  </main>
{% endblock %}
  <!-- MODALS -->
  <div id="modalRoot"></div>

</body>

</html>